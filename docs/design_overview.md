# ALL_Motor

## 设计概览

all motor 驱动始终遵循几个概念

* 清晰
* 高度可配置
* 解耦

为此引入令人心动的设计架构

* 流水化工作链路
* 插件化工作负载

### 流水化工作链路

灵感来源工业流水线，以一个产品(motor)经过各级工人（插件化工作负载）加工后最终得到三项的占空比。

这个架构优势在于将看似盘根错节的无刷驱动步骤（安全监控、核心控制、自动校准等）尽量线性化展现出来，

并且通过许可域和跳步俩个关键方法赋予各个步骤不输于状态机的灵活性，同时又兼具减少控制状态flag满天飞的头疼局面

### 插件化工作负载

依托于流水化工作链路，使得各个工作模块之间可以随意在流水线之间拔插或者失能，同时不必一个一个判断是否应该执行某些步骤；比如对于电机的电角度找零，只需要在上电或者某些时候执行一次，将其作为一个插件，在合适的时候插入工作链路，当其完成后自行拔出，对于运行频率快的核心链路（1KHZ~nKHZ）无需每次判断是否需要执行电角度找零。同时，各个工作模块只需要设置好自己的许可域和跳步频率即可，无需在后续开发中对各个新增的安全条件等其他条件进行判断，大大降低二次开发中的各种失误

## 已完成工作负载插件


| 负载名称                | 完成状态      | 描述                                                                                 |
| ----------------------- | ------------- | ------------------------------------------------------------------------------------ |
| update_motor            | 已完成/更新中 |                                                                                      |
| Current_loop            | 已完成        |                                                                                      |
| Velocity_loop           | 已完成        |                                                                                      |
| Position_loop           | 已完成        |                                                                                      |
| Apply_SVM_PWM           | 已完成        |                                                                                      |
| Find_Commutation_None   | 编写中        | 不做任何处理，直接读取编码器偏移，<br />用于编码器内置已经存储或者做好电角度偏移处理 |
| Find_Commutation_Jitter | 编写中        | 基于抖动法查找零点                                                                   |
| Current_loop            |               |                                                                                      |
| Current_loop            |               |                                                                                      |
| Current_loop            |               |                                                                                      |
| Current_loop            |               |                                                                                      |
| Current_loop            |               |                                                                                      |
| Current_loop            |               |                                                                                      |
| Current_loop            |               |                                                                                      |
